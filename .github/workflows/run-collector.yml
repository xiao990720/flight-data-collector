# 工作流的名称，会显示在 GitHub Actions 页面上
name: Daily Flight Data Collection

# 触发工作流的条件
on:
  # 1. 定时触发：每天世界标准时间 (UTC) 凌晨 1 点运行
  #    注意：UTC 时间比北京时间 (CST) 晚 8 小时，所以 UTC 1点 = 北京时间 9点。
  #    如果你想在北京时间凌晨 1 点运行，应该设置为 UTC 17:00 (前一天)。
  schedule:
    - cron: '0 1 * * *'  # 格式: '分 时 日 月 周'

  # 2. 手动触发：允许你在 GitHub Actions 页面上手动点击 "Run workflow" 来执行
  workflow_dispatch:

# 要执行的任务
jobs:
  build:
    # 指定运行的虚拟服务器环境
    runs-on: ubuntu-latest

    # 任务的具体步骤
    steps:
    # 步骤 1: 检出 (checkout) 你的代码仓库到虚拟服务器
    - uses: actions/checkout@v4

    # 步骤 2: 设置 Python 环境
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9' # 使用与你本地开发兼容的 Python 版本

    # 步骤 3: 安装 Python 依赖库
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 步骤 4: 安装 Playwright 浏览器驱动
    - name: Install Playwright browsers
      run: |
        python -m playwright install chromium

    # 步骤 5: 运行你的 Python 脚本
    - name: Run the data collection script
      run: |
        python collect_multi_flights.py

    # 步骤 6: 上传生成的 CSV 文件作为产物 (Artifact)
    #    这样你就可以在 GitHub 页面上下载结果文件了
    - name: Upload flight data CSV
      uses: actions/upload-artifact@v4
      with:
        name: flight-data-${{ github.run_number }} # 产物的名称，包含运行编号以区分
        path: flight_data_combined/ # 上传这个文件夹下的所有内容

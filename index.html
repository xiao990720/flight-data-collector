<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>航班数据可视化 (Vercel)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 20px; background-color: #f4f7f9; }
        .container { max-width: 1200px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .chart-container { width: 100%; height: 600px; margin-top: 20px; }
        .info { text-align: center; color: #666; margin-top: 10px; font-size: 0.9em; }
        .loading { text-align: center; padding: 50px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <h1>每日航班数量统计</h1>
        <div id="main" class="chart-container">
            <div class="loading">正在加载数据...</div>
        </div>
        <div id="update-info" class="info">数据更新时间: 加载中...</div>
    </div>

    <script type="text/javascript">
        // 初始化 ECharts 实例
        var myChart = echarts.init(document.getElementById('main'));

        // 显示加载动画
        myChart.showLoading();

        // 从 data.json 获取数据
        fetch('data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应错误');
                }
                return response.json();
            })
            .then(chartData => {
                // 隐藏加载动画
                myChart.hideLoading();

                // ECharts 配置项
                var option = {
                    title: { text: '各飞机每日航班次数', subtext: '数据来源: FlightAware', left: 'center' },
                    tooltip: { trigger: 'axis' },
                    grid: { left: '3%', right: '4%', bottom: '15%', containLabel: true },
                    xAxis: {
                        type: 'category',
                        data: chartData.xAxis_data,
                        axisLabel: { interval: 0, rotate: 45 }
                    },
                    yAxis: { type: 'value', name: '航班次数' },
                    series: [{
                        name: '航班次数',
                        type: 'bar',
                        data: chartData.series_data,
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#007bff' }, { offset: 1, color: '#00c6ff' }
                            ])
                        }
                    }]
                };

                // 设置并渲染图表
                myChart.setOption(option);

                // 更新页面信息
                document.getElementById('update-info').innerText = 
                    `数据更新时间: ${chartData.update_time} | 源文件: ${chartData.source_file}`;
            })
            .catch(error => {
                myChart.hideLoading();
                console.error('获取数据时出现问题:', error);
                document.getElementById('main').innerHTML = '<div class="loading">数据加载失败，请稍后重试。</div>';
            });

        // 窗口大小变化时自适应调整图表
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>
